@page "/login"
@page "/"
@inject NavigationManager Nav
@inject AuthenticationStateProvider AuthProvider
@using BlazorApp.Components.ComponentItems
@using BlazorApp.Components.ComponentItems.ParameterEnums
@using BlazorApp.Models
@using BlazorApp.Services.Auth

<PageTitle>Log in</PageTitle>

<div class="login-container">

    <h1>LOG IN</h1>

    <EditForm Model="@_model" OnValidSubmit="@HandleLogin">
        <DataAnnotationsValidator />

        <div class="form-group">
            <label>E-mail</label>
            <InputText class="input-line" @bind-Value="_model.Email" />
            <ValidationMessage For="@(() => _model.Email)" />
        </div>

        <div class="form-group">
            <label>Password</label>
            <InputText type="password" class="input-line" @bind-Value="_model.Password" />
            <ValidationMessage For="@(() => _model.Password)" />
        </div>

         <!-- REMEMBER ME -->
        <div class="form-group">
            <label>
                <input type="checkbox" @bind="_rememberMe" />
                Remember me
            </label>
        </div>

        <Button Look="ButtonLook.Primary" Size="Size.Big" Type="submit">SIGN IN</Button>
    </EditForm>

    <div class="footer">
        <p>Don't have an account?</p>
        <a href="/register">REGISTER</a>
    </div>

</div>

@if (!string.IsNullOrEmpty(_error))
{
    <p style="color:red">@_error</p>
}

@code {
    private LoginModel _model = new();
    private bool _rememberMe ;
    private string? _error;

    private async Task HandleLogin()
    {
        try
        {
            var auth = (AuthProvider)AuthProvider;
            await auth.LoginUser(_model.Email, _model.Password, _rememberMe);

            Nav.NavigateTo("/backlog");
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
    }
}